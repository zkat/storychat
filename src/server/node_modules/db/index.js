"use strict";

let Sequelize = require("sequelize"),
    Q = require("q"),
    config = require("config").db;

function connect() {
  return new Sequelize(config.database, config.username,
                       config.password, config);
}

let db = connect();
function query(q, args) {
  let deferred = Q.defer();
  db.query(q, {}, {raw: true}, args).success(function(results) {
    deferred.resolve(results);
  }).error(function(err) {
    console.error("Error while processing query '", q, "', ", err);
    deferred.reject(err, true);
  });
  return deferred.promise;
}

module.exports = {
  query: query
};
